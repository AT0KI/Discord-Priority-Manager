name: Build and Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: Build executable with spec file
      run: |
        pyinstaller --clean DiscordPriorityManager.spec
          
    - name: Create archive
      run: |
        Compress-Archive -Path dist/DiscordPriorityManager.exe -DestinationPath DiscordPriorityManager-Windows.zip
        
    - name: Upload artifact
      uses: actions/upload-artifact@v3
      with:
        name: DiscordPriorityManager-Windows
        path: DiscordPriorityManager-Windows.zip
        
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: |
          DiscordPriorityManager-Windows.zip
          dist/DiscordPriorityManager.exe
        body: |
          ## Discord Priority Manager Pro
          
          ### üéÆ –ß—Ç–æ –Ω–æ–≤–æ–≥–æ / What's New
          
          –°–º. [CHANGELOG.md](CHANGELOG.md) –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π.
          
          ### üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ / Installation
          
          **–í–∞—Ä–∏–∞–Ω—Ç 1**: –°–∫–∞—á–∞–π—Ç–µ `DiscordPriorityManager.exe` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
          
          **–í–∞—Ä–∏–∞–Ω—Ç 2**: –°–∫–∞—á–∞–π—Ç–µ `DiscordPriorityManager-Windows.zip`, —Ä–∞—Å–ø–∞–∫—É–π—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
          
          ### ‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è / Requirements
          
          - Windows 10/11 (64-bit)
          - –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
          
          ### üêõ –°–æ–æ–±—â–∏—Ç—å –æ–± –æ—à–∏–±–∫–µ / Report a Bug
          
          [–°–æ–∑–¥–∞—Ç—å Issue](https://github.com/${{ github.repository }}/issues)
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
